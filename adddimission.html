<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="assets/css/layui.css">
		<link rel="stylesheet" href="assets/css/admin.css">
		<link rel="icon" href="/favicon.ico">
		<title>离职登记-新增</title>
	</head>
	<style>
		input {
			display: inline-block !important;
		}
		
		#add {
			margin-left: 30px;
		}
	</style>

	<body>
		<form class="layui-form" action="">
			<div class="layui-form-item">
				<label class="layui-form-label">员工姓名</label>
				<form>
					<div class="layui-col-md3">
						<select id="refusename" name="city" lay-verify="">
							<option value="">请选择</option>
						</select>
					</div>
				</form>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">离职时间</label>
				<div class="layui-input-block">
					<input type="date" name="title" class="layui-input" id="test1">
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">离职原因</label>
				<div class="layui-input-block">
					<textarea name="title" placeholder="请输入内容" class="layui-textarea"></textarea>
				</div>
			</div>
			<div style="text-align:center">
				<button type="button" class="layui-btn layui-btn-sm" lay-event="getCheckData" id="add">保存</button>
				<button type="button" class="layui-btn layui-btn-sm" lay-event="getCheckData" id="clo">关闭</button>
			</div>
		</form>
	</body>
	<script src="assets/layui.js"></script>
	<script src="js/index.js"></script>
	<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
	<script src="js/axios.min.js"></script>
	<script src="js/axios_cfg.js"></script>
	<script type="text/html" id="toolbarDemo">

	</script>
	<script>
		layui.use(['laydate', 'form'], function() {
			var laydate = layui.laydate;
			var form = layui.form;
			//执行一个laydate实例
			laydate.render({
				elem: '#test1' //指定元素
			});
		});

		layui.use(["jquery"], function() {
			var $ = layui.jquery;
			$("#add").click(function() {
				var obj = {};
				obj["eid"] = $("#refusename option:selected").val();
				obj["dimissiondate"] = $("[name=\"title\"]:eq(0)").val();
				obj["dimissioncause"] = $("[name=\"title\"]:eq(1)").val();

				console.log(JSON.stringify(obj))
				$.post("http://127.0.0.1:8080/dzw_sys/api/wss/addDimByEid", {
					jsonStr: JSON.stringify(obj)
				}, function(data) {
					if(data) {
						station();
						alert("离职成功");
						CloseWin();
					} else {
						alert("离职失败");
					}
				});
			});
			
			
			$.ajax({
				type: "get",
				dataType: 'json',
				url: "http://127.0.0.1:8080/dzw_sys/api/wss/queryEmpNameId",
				/*async:true*/
				success: function(data) {
					let str = "<option value=''>请选择</option>";
					for(let i of data) {
						str += `<option value='${i.eid}'>${i.ename}</option>`
					}
					$("#refusename").html(str);
					form.render(); //重新渲染 固定写法
				}
			});

			function station() {
				var eid = $("#refusename option:selected").val();
				//alert(eid)
				let _this = this;
				axios.put(`http://127.0.0.1:8080/dzw_sys/api/wss/updateEmpByEid1/${eid}`).then(function(resp) {
					//alert(eid);
					if(resp.data.code == "200") {
						alert("修改成功");
					} else {
						alert("修改失败");
					}
				});

			}

			function CloseWin() {
				parent.location.reload(); // 父页面刷新
				var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
				parent.layer.close(index); //再执行关闭 
			}
		})
	</script>

</html>